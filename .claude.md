# ComerECO - GuÃ­as para Claude Code on the Web

## ğŸ¯ Contexto del Proyecto

ComerECO es un sistema de gestiÃ³n de requisiciones de compra para el Grupo Solven, parte del ecosistema **Solver Center**. Es una aplicaciÃ³n React moderna con Supabase como backend.

### Stack Principal
- **Frontend:** React 18 + Vite + TailwindCSS
- **UI:** shadcn/ui (Radix UI primitives)
- **Backend:** Supabase (PostgreSQL + Auth + Realtime)
- **Estado:** TanStack Query (React Query)
- **Routing:** React Router 6

---

## ğŸ“ Estructura del Proyecto

```
COMERECO-WEBAPP/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/       # Componentes React reutilizables
â”‚   â”‚   â”œâ”€â”€ ui/          # Componentes shadcn/ui (NO MODIFICAR directamente)
â”‚   â”‚   â”œâ”€â”€ layout/      # Header, Footer, Navigation
â”‚   â”‚   â””â”€â”€ forms/       # Formularios y validaciones
â”‚   â”œâ”€â”€ pages/           # PÃ¡ginas principales de la aplicaciÃ³n
â”‚   â”œâ”€â”€ services/        # Servicios API y lÃ³gica de negocio
â”‚   â”œâ”€â”€ hooks/           # Custom React hooks
â”‚   â”œâ”€â”€ lib/             # Utilidades y configuraciones
â”‚   â”‚   â”œâ”€â”€ supabase.js  # Cliente Supabase configurado
â”‚   â”‚   â””â”€â”€ utils.js     # Utilidades generales
â”‚   â”œâ”€â”€ context/         # React Context providers
â”‚   â””â”€â”€ types/           # TypeScript types (si aplica)
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/      # Migraciones de base de datos
â”‚   â”œâ”€â”€ functions/       # Edge Functions de Supabase
â”‚   â””â”€â”€ seed.sql         # Datos de prueba
â”œâ”€â”€ docs/                # DocumentaciÃ³n completa del proyecto
â”œâ”€â”€ scripts/             # Scripts de utilidad
â””â”€â”€ public/              # Assets estÃ¡ticos
```

---

## âœ… Zonas de Trabajo Permitidas

### PUEDES trabajar libremente en:

âœ… `/src/services/` - Toda la lÃ³gica de negocio y llamadas API
âœ… `/src/hooks/` - Custom hooks
âœ… `/src/lib/` (excepto configuraciÃ³n crÃ­tica)
âœ… `/src/pages/` - Nuevas pÃ¡ginas o modificaciones
âœ… `/supabase/migrations/` - Nuevas migraciones (siempre numeradas)
âœ… `/supabase/functions/` - Edge Functions
âœ… `/scripts/` - Scripts de utilidad

### âš ï¸ Modifica con PRECAUCIÃ“N:

âš ï¸ `/src/components/layout/` - Solo si es necesario
âš ï¸ `/src/context/` - Puede afectar toda la app
âš ï¸ `/src/lib/supabase.js` - ConfiguraciÃ³n crÃ­tica
âš ï¸ `package.json` - Solo agregar dependencias necesarias

### ğŸš« NO TOCAR:

ğŸš« `/src/components/ui/` - Componentes shadcn/ui, actualizados manualmente
ğŸš« `.env` - Variables de entorno (sensibles)
ğŸš« `.claude/` - ConfiguraciÃ³n de Claude CLI local
ğŸš« `node_modules/` - Obviamente
ğŸš« `dist/` - Build de producciÃ³n

---

## ğŸ¨ Convenciones de CÃ³digo

### Nombres de Archivos
- Componentes React: `PascalCase.jsx` (ej: `UserProfile.jsx`)
- Servicios: `camelCase.js` (ej: `userService.js`)
- Hooks: `use*.js` (ej: `useAuth.js`)
- Utilidades: `camelCase.js` (ej: `formatters.js`)

### Nombres de Ramas
Cuando crees ramas, usa este formato:
```
claude/feature-[nombre-descriptivo]    # Nuevas features
claude/fix-[nombre-bug]                # Correcciones
claude/refactor-[componente]           # Refactorizaciones
claude/integration-[servicio]          # Integraciones
```

Ejemplos:
- `claude/feature-requisition-notifications`
- `claude/fix-auth-session-timeout`
- `claude/integration-bind-erp`

### Estilo de CÃ³digo
- Usa **funciones de flecha** para componentes React
- Usa **named exports** cuando sea posible
- Prefiere **const** sobre let
- Usa **template literals** para strings dinÃ¡micos
- MantÃ©n **archivos pequeÃ±os** (<300 lÃ­neas)

---

## ğŸ”§ Reglas de Desarrollo

### 1. Supabase
- **SIEMPRE** usa los servicios de `/src/services/` para llamadas a Supabase
- **NO** hagas llamadas directas a `supabase.from()` fuera de servicios
- Usa el cliente configurado: `import { supabase } from '@/lib/supabase'`
- Respeta las polÃ­ticas RLS (Row Level Security) existentes

Ejemplo correcto:
```javascript
// En /src/services/requisitionService.js
export const getRequisitions = async (userId) => {
  const { data, error } = await supabase
    .from('requisitions')
    .select('*')
    .eq('user_id', userId)

  if (error) throw error
  return data
}

// En componente
import { getRequisitions } from '@/services/requisitionService'
```

### 2. TanStack Query (React Query)
- Usa hooks de React Query para data fetching
- Nomenclatura: `use[Entity]` para queries (ej: `useProducts`)
- Nomenclatura: `use[Action][Entity]` para mutations (ej: `useCreateRequisition`)

```javascript
export const useProducts = () => {
  return useQuery({
    queryKey: ['products'],
    queryFn: productService.getAll
  })
}
```

### 3. Componentes
- Componentes funcionales con hooks
- Extrae lÃ³gica compleja a custom hooks
- Props tipadas con PropTypes o comentarios JSDoc
- Manejo de loading y error states

```javascript
const ProductCard = ({ product, onSelect }) => {
  // LÃ³gica del componente
  return <div>...</div>
}
```

### 4. Migraciones de Base de Datos
Cuando crees migraciones:
```sql
-- Nombre: YYYYMMDDHHMMSS_descripcion_breve.sql
-- Ejemplo: 20251107120000_add_notifications_table.sql

BEGIN;

-- Tu migraciÃ³n aquÃ­
CREATE TABLE IF NOT EXISTS public.notifications (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES profiles(id),
  message text NOT NULL,
  created_at timestamptz DEFAULT now()
);

-- RLS siempre
ALTER TABLE public.notifications ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own notifications"
  ON public.notifications
  FOR SELECT
  USING (auth.uid() = user_id);

COMMIT;
```

---

## ğŸ§ª Testing y ValidaciÃ³n

### Antes de crear un Pull Request:

1. **Verifica que el cÃ³digo funciona:**
   ```bash
   npm run dev
   # Prueba manualmente la funcionalidad
   ```

2. **Verifica que el build funciona:**
   ```bash
   npm run build
   ```

3. **Si modificaste Supabase:**
   - Verifica las migraciones localmente
   - Documenta los cambios en el PR

4. **Escribe tests si es posible** (opcional pero apreciado)

---

## ğŸ¯ Tareas TÃ­picas y CÃ³mo Abordarlas

### Agregar una nueva tabla en Supabase
1. Crea migraciÃ³n en `/supabase/migrations/`
2. Incluye RLS policies
3. Actualiza `seed.sql` si necesitas datos de prueba
4. Crea servicio en `/src/services/`
5. Crea hooks de React Query si es necesario

### Agregar una nueva pÃ¡gina
1. Crea componente en `/src/pages/`
2. Agrega ruta en `/src/App.jsx` o router config
3. Crea servicios necesarios
4. Actualiza navegaciÃ³n si es necesario

### Agregar integraciÃ³n externa (ej: Bind ERP)
1. Crea servicio en `/src/services/[nombre]Service.js`
2. Si necesitas webhook, crea Edge Function en `/supabase/functions/`
3. Documenta API endpoints en `/docs/api/`
4. Agrega variables de entorno necesarias a `.env.example`

### Corregir un bug
1. Identifica el archivo problemÃ¡tico
2. Agrega logging temporal si es necesario
3. Corrige el problema
4. Verifica que no rompe otras funcionalidades
5. Documenta el fix en el commit

---

## ğŸ“ Commits y Pull Requests

### Formato de Commits
```
tipo(scope): descripciÃ³n breve

DescripciÃ³n mÃ¡s detallada si es necesario.

Refs: #issue-number (si aplica)
```

**Tipos:**
- `feat`: Nueva funcionalidad
- `fix`: CorrecciÃ³n de bug
- `refactor`: RefactorizaciÃ³n sin cambio funcional
- `docs`: Cambios en documentaciÃ³n
- `test`: Agregar o modificar tests
- `chore`: Cambios en build, deps, etc.

**Ejemplos:**
```
feat(requisitions): agregar filtro por fecha
fix(auth): corregir timeout de sesiÃ³n en Safari
refactor(services): simplificar lÃ³gica de productos
```

### Pull Request Template
```markdown
## ğŸ¯ Objetivo
[DescripciÃ³n breve de quÃ© hace este PR]

## ğŸ”§ Cambios Realizados
- [ ] Cambio 1
- [ ] Cambio 2
- [ ] Cambio 3

## ğŸ§ª Testing
- [ ] Probado en desarrollo local
- [ ] Build funciona correctamente
- [ ] Migraciones verificadas (si aplica)

## ğŸ“š DocumentaciÃ³n
- [ ] README actualizado (si aplica)
- [ ] Docs actualizados (si aplica)

## âš ï¸ Notas Adicionales
[Cualquier contexto adicional]
```

---

## ğŸš€ Comandos Ãštiles

```bash
# Desarrollo
npm run dev                    # Servidor de desarrollo

# Build
npm run build                  # Build de producciÃ³n
npm run preview                # Preview del build

# Supabase (si tienes CLI local)
supabase start                 # Inicia Supabase local
supabase db reset              # Reset DB local
supabase migration new [name]  # Nueva migraciÃ³n

# Git
git fetch origin               # Actualizar referencias remotas
git checkout -b claude/[name]  # Crear nueva rama
git push -u origin HEAD        # Push y crear PR
```

---

## ğŸ¯ Objetivos de Calidad

Cuando trabajes en este proyecto, prioriza:

1. **Claridad:** CÃ³digo fÃ¡cil de entender
2. **Consistencia:** Sigue los patrones existentes
3. **Seguridad:** Nunca expongas credenciales o datos sensibles
4. **Performance:** Optimiza queries y renders
5. **DocumentaciÃ³n:** Documenta decisiones complejas

---

## ğŸ“ Contacto y EscalaciÃ³n

Si encuentras algo que requiere decisiÃ³n humana:
- ğŸ”´ **Cambios de arquitectura** â†’ Crear issue y esperar aprobaciÃ³n
- ğŸŸ¡ **Dependencias nuevas** â†’ Documentar razÃ³n en PR
- ğŸŸ¢ **Bugfixes y mejoras** â†’ Proceder con confianza

---

## ğŸ¨ DiseÃ±o y UX

- Usa componentes de shadcn/ui cuando sea posible
- MantÃ©n consistencia con el diseÃ±o existente
- Responsive design es obligatorio (mobile-first)
- Accesibilidad: usa atributos ARIA cuando sea necesario

---

Â¡Gracias por contribuir a ComerECO! ğŸš€

---

_Ãšltima actualizaciÃ³n: 2025-11-07_
_Para mÃ¡s informaciÃ³n: ver `/docs/README.md`_
